<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª PR15: Ø³ÛŒØ³ØªÙ… ØªØ´Ø®ÛŒØµ Ù‡ÙˆÛŒØª Ú†Ù†Ø¯Ø³Ø·Ø­ÛŒ Ùˆ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ù…Ù‡Ø§Ø¬Ù…</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            direction: rtl;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .header h1 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            line-height: 1.6;
        }

        .test-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .test-section h2 {
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e5e7eb;
        }

        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin: 10px 10px 10px 0;
            transition: all 0.3s ease;
        }

        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .test-button.danger {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: #333;
        }

        .test-button.success {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            color: #333;
        }

        .result-box {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }

        .result-box.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .result-box.success {
            background: #d1fae5;
            border-color: #a7f3d0;
        }

        .result-box.error {
            background: #fee2e2;
            border-color: #fecaca;
        }

        .result-box.info {
            background: #dbeafe;
            border-color: #bfdbfe;
        }

        .result-box pre {
            background: white;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            margin-top: 10px;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 8px;
        }

        .status-indicator.success {
            background: #10b981;
        }

        .status-indicator.error {
            background: #ef4444;
        }

        .status-indicator.warning {
            background: #f59e0b;
        }

        .info-box {
            background: #fef3c7;
            border: 2px solid #fbbf24;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .info-box h3 {
            color: #92400e;
            margin-bottom: 8px;
        }

        .info-box ul {
            margin-right: 20px;
            color: #78350f;
        }

        .info-box li {
            margin-bottom: 5px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .role-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin: 5px;
        }

        .role-badge.admin {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .role-badge.customer {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .role-badge.guest {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .role-badge.intruder {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: #333;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
        }

        .card h3 {
            color: #1f2937;
            margin-bottom: 10px;
        }

        .card p {
            color: #6b7280;
            font-size: 14px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ›¡ï¸ PR15: Ø³ÛŒØ³ØªÙ… ØªØ´Ø®ÛŒØµ Ù‡ÙˆÛŒØª Ú†Ù†Ø¯Ø³Ø·Ø­ÛŒ Ùˆ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ù…Ù‡Ø§Ø¬Ù…</h1>
            <p>
                Ø§ÛŒÙ† ØµÙØ­Ù‡ Ø¨Ø±Ø§ÛŒ Ø¢Ø²Ù…Ø§ÛŒØ´ Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ PR15 Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª Ú©Ù‡ Ø´Ø§Ù…Ù„ ØªØ´Ø®ÛŒØµ Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø±ØŒ 
                Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ù…Ù‡Ø§Ø¬Ù…ÛŒÙ†ØŒ Ú©Ù†ØªØ±Ù„ Ø¯Ø³ØªØ±Ø³ÛŒ Ù¾ÙˆÛŒØ§ Ùˆ Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ Ù…ÛŒâ€ŒØ¨Ø§Ø´Ø¯.
            </p>
        </div>

        <div class="info-box">
            <h3>ğŸ“‹ Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ ØªØ³Øª Ø´Ø¯Ù‡:</h3>
            <ul>
                <li>ØªØ´Ø®ÛŒØµ Ø®ÙˆØ¯Ú©Ø§Ø± Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø± (Ù…Ø¯ÛŒØ±ØŒ Ù…Ø´ØªØ±ÛŒØŒ Ù…ÛŒÙ‡Ù…Ø§Ù†ØŒ Ù…Ù‡Ø§Ø¬Ù…)</li>
                <li>Ø³ÛŒØ³ØªÙ… Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø±ÙØªØ§Ø±Ù‡Ø§ÛŒ Ù…Ø´Ú©ÙˆÚ© (IDS)</li>
                <li>Ú©Ù†ØªØ±Ù„ Ø¯Ø³ØªØ±Ø³ÛŒ Ù¾ÙˆÛŒØ§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ù‚Ø´ (ACL)</li>
                <li>Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ Ø¨Ù‡ Ù…Ø¯ÛŒØ±</li>
                <li>Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù…ØªÙ†Ø§Ø³Ø¨ Ø¨Ø§ Ù†Ù‚Ø´</li>
            </ul>
        </div>

        <!-- Test 1: Role Context -->
        <div class="test-section">
            <h2>ØªØ³Øª 1: Ø¯Ø±ÛŒØ§ÙØª Ù…ØªÙ†Ø§Ø³Ø¨ Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø±</h2>
            <p>Ø§ÛŒÙ† ØªØ³Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø± Ø¬Ø§Ø±ÛŒ Ø±Ø§ Ø§Ø² Ø³Ø±ÙˆØ± Ø¯Ø±ÛŒØ§ÙØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯.</p>
            <button class="test-button" onclick="testRoleContext()">
                Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†Ù‚Ø´
            </button>
            <div id="role-result" class="result-box"></div>
        </div>

        <!-- Test 2: Available Tools -->
        <div class="test-section">
            <h2>ØªØ³Øª 2: Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ù‚Ø´</h2>
            <p>Ø§ÛŒÙ† ØªØ³Øª Ù„ÛŒØ³Øª Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ø¯Ø³ØªØ±Ø³ Ø¨Ø±Ø§ÛŒ Ù†Ù‚Ø´ ÙØ¹Ù„ÛŒ Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.</p>
            <button class="test-button success" onclick="testAvailableTools()">
                Ù†Ù…Ø§ÛŒØ´ Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§
            </button>
            <div id="tools-result" class="result-box"></div>
        </div>

        <!-- Test 3: Intruder Detection -->
        <div class="test-section">
            <h2>ØªØ³Øª 3: Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ù…Ù‡Ø§Ø¬Ù…</h2>
            <p>
                <strong>âš ï¸ Ù‡Ø´Ø¯Ø§Ø±:</strong> Ø§ÛŒÙ† ØªØ³Øª Ø±ÙØªØ§Ø± Ù…Ø´Ú©ÙˆÚ© Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ùˆ Ù…Ù…Ú©Ù† Ø§Ø³Øª 
                Ø¯Ø³ØªØ±Ø³ÛŒ Ø´Ù…Ø§ Ø±Ø§ Ù…ÙˆÙ‚ØªØ§Ù‹ Ù…Ø³Ø¯ÙˆØ¯ Ú©Ù†Ø¯. Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø­Ø§Ù„Øª Ø¹Ø§Ø¯ÛŒØŒ ØµÙØ­Ù‡ Ø±Ø§ Ø±ÙØ±Ø´ Ú©Ù†ÛŒØ¯.
            </p>
            <button class="test-button danger" onclick="testIntruderDetection()">
                Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø­Ù…Ù„Ù‡
            </button>
            <div id="intruder-result" class="result-box"></div>
        </div>

        <!-- Test 4: Security Alerts -->
        <div class="test-section">
            <h2>ØªØ³Øª 4: Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ (ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±)</h2>
            <p>Ø§ÛŒÙ† ØªØ³Øª Ù„ÛŒØ³Øª Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.</p>
            <button class="test-button" onclick="testSecurityAlerts()">
                Ø¯Ø±ÛŒØ§ÙØª Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§
            </button>
            <div id="alerts-result" class="result-box"></div>
        </div>

        <!-- Test 5: Capability Check -->
        <div class="test-section">
            <h2>ØªØ³Øª 5: Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§</h2>
            <p>Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ú©Ù‡ Ø¢ÛŒØ§ Ú©Ø§Ø±Ø¨Ø± Ø¬Ø§Ø±ÛŒ Ø¨Ù‡ Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø®Ø§Øµ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯Ø§Ø±Ø¯ ÛŒØ§ Ø®ÛŒØ±.</p>
            <div style="margin-top: 15px;">
                <button class="test-button" onclick="checkCapability('view_analytics')">
                    Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ø¢Ù…Ø§Ø± Ø¨Ø¨ÛŒÙ†Ù…ØŸ
                </button>
                <button class="test-button" onclick="checkCapability('view_orders')">
                    Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ Ø¨Ø¨ÛŒÙ†Ù…ØŸ
                </button>
                <button class="test-button" onclick="checkCapability('use_chat')">
                    Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ú†Øª Ú©Ù†Ù…ØŸ
                </button>
            </div>
            <div id="capability-result" class="result-box"></div>
        </div>

        <!-- Role Showcase -->
        <div class="test-section">
            <h2>Ù†Ù…Ø§ÛŒØ´ Ù†Ù‚Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù</h2>
            <p>Ù‡Ø± Ù†Ù‚Ø´ Ø¯Ø§Ø±Ø§ÛŒ Ø¸Ø§Ù‡Ø± Ùˆ Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù…Ù†Ø­ØµØ± Ø¨Ù‡ ÙØ±Ø¯ Ø§Ø³Øª:</p>
            <div class="grid">
                <div class="card">
                    <h3><span class="role-badge admin">Ù…Ø¯ÛŒØ±</span></h3>
                    <p>
                        Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ø§Ù…Ù„ Ø¨Ù‡ Ø¢Ù…Ø§Ø±ØŒ Ú¯Ø²Ø§Ø±Ø´ ÙØ±ÙˆØ´ØŒ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†ØŒ Ø§Ø·Ù„Ø³ Ùˆ Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ.
                    </p>
                </div>
                <div class="card">
                    <h3><span class="role-badge customer">Ù…Ø´ØªØ±ÛŒ</span></h3>
                    <p>
                        Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø³ÙØ§Ø±Ø´Ø§ØªØŒ ØªÙ…Ø¯ÛŒØ¯ ÙØ§Ú©ØªÙˆØ±ØŒ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ù…Ø±Ø³ÙˆÙ„Ù‡ Ùˆ Ø§ÛŒØ¬Ø§Ø¯ ØªÛŒÚ©Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ.
                    </p>
                </div>
                <div class="card">
                    <h3><span class="role-badge guest">Ù…ÛŒÙ‡Ù…Ø§Ù†</span></h3>
                    <p>
                        Ù…Ø¹Ø±ÙÛŒ Ø®Ø¯Ù…Ø§ØªØŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ ØªÛŒØ±Ø§Ú˜ØŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª Ùˆ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø³Ø±ÛŒØ¹ Ø¨Ø§ OTP.
                    </p>
                </div>
                <div class="card">
                    <h3><span class="role-badge intruder">Ù…Ù‡Ø§Ø¬Ù…</span></h3>
                    <p>
                        Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø³Ø¯ÙˆØ¯ØŒ Ù†Ù…Ø§ÛŒØ´ Ù‡Ø´Ø¯Ø§Ø± Ø§Ù…Ù†ÛŒØªÛŒ Ùˆ Ø«Ø¨Øª Ø¯Ø± Ù„Ø§Ú¯ Ø§Ù…Ù†ÛŒØªÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Helper function to get nonce
        function getNonce() {
            return window.homayeParallelUIConfig?.nonce || '';
        }

        // Helper function to display results
        function displayResult(elementId, data, type = 'info') {
            const resultBox = document.getElementById(elementId);
            resultBox.className = `result-box show ${type}`;
            
            let html = '';
            if (typeof data === 'object') {
                html = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            } else {
                html = `<p>${data}</p>`;
            }
            
            resultBox.innerHTML = html;
        }

        // Test 1: Get Role Context
        async function testRoleContext() {
            try {
                const response = await fetch('/wp-json/homaye-tabesh/v1/capabilities/context', {
                    headers: {
                        'X-WP-Nonce': getNonce()
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayResult('role-result', {
                        Ù†Ù‚Ø´: data.context.role,
                        Ù‡ÙˆÛŒØª: data.context.identity,
                        'Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§': data.context.capabilities,
                        'Ù¾ÛŒØ§Ù… Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ': data.welcome_message
                    }, 'success');
                } else {
                    displayResult('role-result', 'Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª', 'error');
                }
            } catch (error) {
                displayResult('role-result', `Ø®Ø·Ø§: ${error.message}`, 'error');
            }
        }

        // Test 2: Get Available Tools
        async function testAvailableTools() {
            try {
                const response = await fetch('/wp-json/homaye-tabesh/v1/capabilities/tools', {
                    headers: {
                        'X-WP-Nonce': getNonce()
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayResult('tools-result', {
                        'ØªØ¹Ø¯Ø§Ø¯ Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§': data.tools.length,
                        'Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯': data.tools.map(t => t.label)
                    }, 'success');
                } else {
                    displayResult('tools-result', 'Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§', 'error');
                }
            } catch (error) {
                displayResult('tools-result', `Ø®Ø·Ø§: ${error.message}`, 'error');
            }
        }

        // Test 3: Intruder Detection Simulation
        async function testIntruderDetection() {
            try {
                // Simulate suspicious behavior by accessing a sensitive file
                const response = await fetch('/wp-config.php', {
                    method: 'GET'
                });
                
                // Now check if we're detected as intruder
                const contextResponse = await fetch('/wp-json/homaye-tabesh/v1/capabilities/context', {
                    headers: {
                        'X-WP-Nonce': getNonce()
                    }
                });
                
                const data = await contextResponse.json();
                
                if (data.context.role === 'intruder') {
                    displayResult('intruder-result', {
                        ÙˆØ¶Ø¹ÛŒØª: 'Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø´Ø¯Ù‡',
                        'Ø¯Ù„ÛŒÙ„ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ': data.context.detection_reason || 'ÙØ¹Ø§Ù„ÛŒØª Ù…Ø´Ú©ÙˆÚ©',
                        ØªÙˆØ¶ÛŒØ­Ø§Øª: 'Ø´Ù…Ø§ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ù…Ù‡Ø§Ø¬Ù… Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø´Ø¯ÛŒØ¯. Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø­Ø§Ù„Øª Ø¹Ø§Ø¯ÛŒ ØµÙØ­Ù‡ Ø±Ø§ Ø±ÙØ±Ø´ Ú©Ù†ÛŒØ¯.'
                    }, 'error');
                } else {
                    displayResult('intruder-result', {
                        ÙˆØ¶Ø¹ÛŒØª: 'Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ù†Ø´Ø¯',
                        ØªÙˆØ¶ÛŒØ­Ø§Øª: 'Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø§Ù…ØªÛŒØ§Ø² Ù…Ø´Ú©ÙˆÚ© Ø´Ù…Ø§ Ù‡Ù†ÙˆØ² Ø¨Ù‡ Ø¢Ø³ØªØ§Ù†Ù‡ Ù†Ø±Ø³ÛŒØ¯Ù‡ Ø¨Ø§Ø´Ø¯.'
                    }, 'info');
                }
            } catch (error) {
                displayResult('intruder-result', `Ø®Ø·Ø§: ${error.message}`, 'error');
            }
        }

        // Test 4: Get Security Alerts
        async function testSecurityAlerts() {
            try {
                const response = await fetch('/wp-json/homaye-tabesh/v1/security/alerts?limit=10', {
                    headers: {
                        'X-WP-Nonce': getNonce()
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayResult('alerts-result', {
                        'ØªØ¹Ø¯Ø§Ø¯ Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§': data.total_count,
                        'Ø¢Ø®Ø±ÛŒÙ† Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§': data.alerts.slice(0, 3).map(a => ({
                            Ù†ÙˆØ¹: a.event_type,
                            'Ø¢ÛŒâ€ŒÙ¾ÛŒ': a.ip_address,
                            Ø¯Ù„ÛŒÙ„: a.detection_reason,
                            ØªØ§Ø±ÛŒØ®: a.created_at
                        }))
                    }, 'success');
                } else {
                    displayResult('alerts-result', 'Ø¹Ø¯Ù… Ø¯Ø³ØªØ±Ø³ÛŒ (ÙÙ‚Ø· Ù…Ø¯ÛŒØ±)', 'error');
                }
            } catch (error) {
                displayResult('alerts-result', `Ø®Ø·Ø§: ${error.message}`, 'error');
            }
        }

        // Test 5: Check Capability
        async function checkCapability(capability) {
            try {
                const contextResponse = await fetch('/wp-json/homaye-tabesh/v1/capabilities/context', {
                    headers: {
                        'X-WP-Nonce': getNonce()
                    }
                });
                
                const data = await contextResponse.json();
                
                if (data.success) {
                    const hasCapability = data.context.capabilities.includes(capability);
                    
                    displayResult('capability-result', {
                        Ù‚Ø§Ø¨Ù„ÛŒØª: capability,
                        ÙˆØ¶Ø¹ÛŒØª: hasCapability ? 'âœ… Ø¯Ø§Ø±Ø¯' : 'âŒ Ù†Ø¯Ø§Ø±Ø¯',
                        'Ù†Ù‚Ø´ ÙØ¹Ù„ÛŒ': data.context.role,
                        'ØªÙ…Ø§Ù… Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§': data.context.capabilities
                    }, hasCapability ? 'success' : 'error');
                } else {
                    displayResult('capability-result', 'Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ', 'error');
                }
            } catch (error) {
                displayResult('capability-result', `Ø®Ø·Ø§: ${error.message}`, 'error');
            }
        }

        // Auto-test on load
        window.addEventListener('load', () => {
            console.log('PR15 Validation Page Loaded');
            // Automatically fetch role context on load
            testRoleContext();
        });
    </script>
</body>
</html>
