<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PR4 Validation - Core Intelligence Layer</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f7f9fc;
            border-radius: 8px;
            border-right: 4px solid #667eea;
        }
        
        .test-section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        .test-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-bottom: 10px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
        }
        
        .test-item .status {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-left: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .test-item .status.pending {
            background: #ffd700;
            color: white;
        }
        
        .test-item .status.success {
            background: #4caf50;
            color: white;
        }
        
        .test-item .status.error {
            background: #f44336;
            color: white;
        }
        
        .test-item .label {
            flex: 1;
            color: #333;
        }
        
        .test-item .result {
            color: #666;
            font-size: 14px;
        }
        
        .demo-form {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin-left: 10px;
            transition: transform 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .console-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .console-output .log {
            margin-bottom: 8px;
            padding: 4px 0;
        }
        
        .console-output .log.info {
            color: #4fc3f7;
        }
        
        .console-output .log.success {
            color: #4caf50;
        }
        
        .console-output .log.error {
            color: #f44336;
        }
        
        .et_pb_pricing {
            background: #f7f9fc;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
        }
        
        .price {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª PR4 Validation Test Suite</h1>
        <p class="subtitle">Core Intelligence - Environmental Perception Layer</p>
        
        <!-- Test Section 1: Module Loading -->
        <div class="test-section">
            <h2>Û±. Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§</h2>
            <div class="test-item" id="test-indexer">
                <div class="status pending">â³</div>
                <div class="label">Homa Indexer</div>
                <div class="result"></div>
            </div>
            <div class="test-item" id="test-input-observer">
                <div class="status pending">â³</div>
                <div class="label">Homa Input Observer</div>
                <div class="result"></div>
            </div>
            <div class="test-item" id="test-navigator">
                <div class="status pending">â³</div>
                <div class="label">Homa Spatial Navigator</div>
                <div class="result"></div>
            </div>
            <div class="test-item" id="test-tour">
                <div class="status pending">â³</div>
                <div class="label">Homa Tour Manager</div>
                <div class="result"></div>
            </div>
        </div>
        
        <!-- Test Section 2: Semantic Indexing -->
        <div class="test-section">
            <h2>Û². Ø¨Ø±Ø±Ø³ÛŒ Ù†Ú¯Ø§Ø´Øª Ù…Ø¹Ù†Ø§ÛŒÛŒ (Semantic Indexing)</h2>
            <div class="test-item" id="test-indexing">
                <div class="status pending">â³</div>
                <div class="label">ØªØ¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø´Ø¯Ù‡</div>
                <div class="result"></div>
            </div>
            <div class="test-item" id="test-field-map">
                <div class="status pending">â³</div>
                <div class="label">Ù†Ù‚Ø´Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù…Ø¹Ù†Ø§ÛŒÛŒ</div>
                <div class="result"></div>
            </div>
        </div>
        
        <!-- Test Section 3: Demo Form -->
        <div class="test-section">
            <h2>Û³. ÙØ±Ù… ØªØ³Øª (Ø¨Ø±Ø§ÛŒ Input Observer Ùˆ Navigation)</h2>
            <div class="demo-form">
                <div class="form-group">
                    <label for="book_title">Ù†Ø§Ù… Ú©ØªØ§Ø¨</label>
                    <input type="text" id="book_title" name="book_title" placeholder="Ù…Ø«Ø§Ù„: Ø±Ù…Ø§Ù† Ø¹Ø§Ø´Ù‚Ø§Ù†Ù‡ Ø¨Ø±Ø§ÛŒ Ù†ÙˆØ¬ÙˆØ§Ù†Ø§Ù†">
                </div>
                
                <div class="form-group">
                    <label for="book_pages">ØªØ¹Ø¯Ø§Ø¯ ØµÙØ­Ø§Øª</label>
                    <input type="number" id="book_pages" name="book_pages" placeholder="Ù…Ø«Ø§Ù„: 200">
                </div>
                
                <div class="form-group">
                    <label for="book_description">ØªÙˆØ¶ÛŒØ­Ø§Øª Ú©ØªØ§Ø¨</label>
                    <textarea id="book_description" name="book_description" rows="4" placeholder="Ø¯Ø± Ù…ÙˆØ±Ø¯ Ú©ØªØ§Ø¨ Ø®ÙˆØ¯ ØªÙˆØ¶ÛŒØ­ Ø¯Ù‡ÛŒØ¯..."></textarea>
                </div>
                
                <button class="btn" onclick="testNavigation()">ğŸ§­ ØªØ³Øª Ù†Ø§ÙˆØ¨Ø±ÛŒ</button>
                <button class="btn" onclick="testTour()">ğŸ¯ ØªØ³Øª ØªÙˆØ±</button>
                <button class="btn" onclick="testHighlight()">âœ¨ ØªØ³Øª Ù‡Ø§ÛŒÙ„Ø§ÛŒØª</button>
            </div>
            
            <!-- Mock Pricing Table -->
            <div class="et_pb_pricing">
                <h3>Ø¬Ø¯ÙˆÙ„ Ù‚ÛŒÙ…Øª (Mock)</h3>
                <div class="price">Û±ÛµÛ°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†</div>
                <p>Ù‚ÛŒÙ…Øª Ú†Ø§Ù¾ Ú©ØªØ§Ø¨ Ø´Ù…Ø§</p>
            </div>
        </div>
        
        <!-- Test Section 4: Interactive Tests -->
        <div class="test-section">
            <h2>Û´. ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ ØªØ¹Ø§Ù…Ù„ÛŒ</h2>
            <div class="test-item" id="test-navigation">
                <div class="status pending">â³</div>
                <div class="label">Spatial Navigation</div>
                <div class="result">Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ "ØªØ³Øª Ù†Ø§ÙˆØ¨Ø±ÛŒ" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</div>
            </div>
            <div class="test-item" id="test-tour-interactive">
                <div class="status pending">â³</div>
                <div class="label">Interactive Tour</div>
                <div class="result">Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ "ØªØ³Øª ØªÙˆØ±" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</div>
            </div>
            <div class="test-item" id="test-input-monitoring">
                <div class="status pending">â³</div>
                <div class="label">Input Monitoring</div>
                <div class="result">Ø¯Ø± ÙÛŒÙ„Ø¯ "Ù†Ø§Ù… Ú©ØªØ§Ø¨" ØªØ§ÛŒÙ¾ Ú©Ù†ÛŒØ¯</div>
            </div>
        </div>
        
        <!-- Console Output -->
        <div class="test-section">
            <h2>Ûµ. Ø®Ø±ÙˆØ¬ÛŒ Console</h2>
            <div class="console-output" id="console"></div>
        </div>
    </div>
    
    <script>
        // Mock console output
        const consoleDiv = document.getElementById('console');
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addConsoleLog('info', args.join(' '));
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addConsoleLog('error', args.join(' '));
        };
        
        function addConsoleLog(type, message) {
            const log = document.createElement('div');
            log.className = `log ${type}`;
            log.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            consoleDiv.appendChild(log);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }
        
        function updateTestStatus(testId, status, result) {
            const testItem = document.getElementById(testId);
            const statusEl = testItem.querySelector('.status');
            const resultEl = testItem.querySelector('.result');
            
            statusEl.className = `status ${status}`;
            statusEl.textContent = status === 'success' ? 'âœ“' : (status === 'error' ? 'âœ—' : 'â³');
            resultEl.textContent = result;
        }
        
        // Test 1: Module Loading
        function testModuleLoading() {
            console.log('=== Testing Module Loading ===');
            
            // Test Indexer
            if (typeof HomaIndexer !== 'undefined') {
                updateTestStatus('test-indexer', 'success', 'âœ“ Loaded');
                console.log('âœ“ HomaIndexer loaded');
            } else {
                updateTestStatus('test-indexer', 'error', 'âœ— Not loaded');
                console.error('âœ— HomaIndexer not loaded');
            }
            
            // Test Input Observer
            if (typeof HomaInputObserver !== 'undefined') {
                updateTestStatus('test-input-observer', 'success', 'âœ“ Loaded');
                console.log('âœ“ HomaInputObserver loaded');
            } else {
                updateTestStatus('test-input-observer', 'error', 'âœ— Not loaded');
                console.error('âœ— HomaInputObserver not loaded');
            }
            
            // Test Navigator
            if (typeof HomaSpatialNavigator !== 'undefined' && typeof HomaNavigation !== 'undefined') {
                updateTestStatus('test-navigator', 'success', 'âœ“ Loaded');
                console.log('âœ“ HomaSpatialNavigator loaded');
            } else {
                updateTestStatus('test-navigator', 'error', 'âœ— Not loaded');
                console.error('âœ— HomaSpatialNavigator not loaded');
            }
            
            // Test Tour Manager
            if (typeof HomaTourManager !== 'undefined' && typeof HomaTour !== 'undefined') {
                updateTestStatus('test-tour', 'success', 'âœ“ Loaded');
                console.log('âœ“ HomaTourManager loaded');
            } else {
                updateTestStatus('test-tour', 'error', 'âœ— Not loaded');
                console.error('âœ— HomaTourManager not loaded');
            }
        }
        
        // Test 2: Semantic Indexing
        function testSemanticIndexing() {
            console.log('=== Testing Semantic Indexing ===');
            
            if (typeof HomaIndexer !== 'undefined') {
                const count = HomaIndexer.getAll().length;
                updateTestStatus('test-indexing', 'success', `${count} elements indexed`);
                console.log(`âœ“ ${count} elements indexed`);
                
                const fieldCount = HomaIndexer.fieldMap.size;
                updateTestStatus('test-field-map', 'success', `${fieldCount} semantic fields`);
                console.log(`âœ“ ${fieldCount} semantic fields mapped`);
            } else {
                updateTestStatus('test-indexing', 'error', 'Indexer not available');
                updateTestStatus('test-field-map', 'error', 'Indexer not available');
            }
        }
        
        // Test 3: Navigation
        function testNavigation() {
            console.log('=== Testing Navigation ===');
            
            if (typeof HomaNavigation !== 'undefined') {
                HomaNavigation.scrollTo('.et_pb_pricing', {
                    offset: 50,
                    highlight: true
                }).then(() => {
                    updateTestStatus('test-navigation', 'success', 'âœ“ Navigation successful');
                    console.log('âœ“ Navigated to pricing table');
                    addConsoleLog('success', 'Navigation test passed!');
                }).catch((error) => {
                    updateTestStatus('test-navigation', 'error', 'âœ— Navigation failed');
                    console.error('âœ— Navigation failed:', error);
                });
            } else {
                updateTestStatus('test-navigation', 'error', 'Navigator not available');
            }
        }
        
        // Test 4: Tour
        function testTour() {
            console.log('=== Testing Tour ===');
            
            if (typeof HomaTour !== 'undefined') {
                HomaTour.start({
                    title: 'ØªØ³Øª ØªÙˆØ± Ø¢Ù…ÙˆØ²Ø´ÛŒ',
                    steps: [
                        {
                            selector: '#book_title',
                            title: 'ÙÛŒÙ„Ø¯ Ù†Ø§Ù… Ú©ØªØ§Ø¨',
                            message: 'Ø§ÛŒÙ† ÙÛŒÙ„Ø¯ Ø¨Ø±Ø§ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† Ù†Ø§Ù… Ú©ØªØ§Ø¨ Ø§Ø³Øª'
                        },
                        {
                            selector: '#book_pages',
                            title: 'ÙÛŒÙ„Ø¯ ØªØ¹Ø¯Ø§Ø¯ ØµÙØ­Ø§Øª',
                            message: 'ØªØ¹Ø¯Ø§Ø¯ ØµÙØ­Ø§Øª Ú©ØªØ§Ø¨ Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯'
                        },
                        {
                            selector: '.et_pb_pricing',
                            title: 'Ø¬Ø¯ÙˆÙ„ Ù‚ÛŒÙ…Øª',
                            message: 'Ù‚ÛŒÙ…Øª Ù†Ù‡Ø§ÛŒÛŒ Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯'
                        }
                    ]
                });
                
                updateTestStatus('test-tour-interactive', 'success', 'âœ“ Tour started');
                console.log('âœ“ Tour started successfully');
                addConsoleLog('success', 'Tour test passed!');
            } else {
                updateTestStatus('test-tour-interactive', 'error', 'Tour Manager not available');
            }
        }
        
        // Test 5: Highlight
        function testHighlight() {
            console.log('=== Testing Highlight ===');
            
            if (typeof HomaNavigation !== 'undefined') {
                const fields = ['#book_title', '#book_pages', '#book_description'];
                let index = 0;
                
                function highlightNext() {
                    if (index < fields.length) {
                        HomaNavigation.highlightElement(fields[index], {
                            duration: 2000
                        });
                        console.log(`âœ“ Highlighted: ${fields[index]}`);
                        index++;
                        setTimeout(highlightNext, 2500);
                    }
                }
                
                highlightNext();
                addConsoleLog('success', 'Highlight test started!');
            }
        }
        
        // Monitor input
        if (typeof HomaInputObserver !== 'undefined') {
            HomaInputObserver.onIntent((eventType, data) => {
                if (eventType === 'intent_detected') {
                    updateTestStatus('test-input-monitoring', 'success', `âœ“ Detected: ${data.concepts.keywords.join(', ')}`);
                    console.log('âœ“ Intent detected:', data);
                    addConsoleLog('success', `Intent detected in field: ${data.fieldName}`);
                }
            });
        }
        
        // Run tests on load
        window.addEventListener('load', function() {
            setTimeout(() => {
                testModuleLoading();
                setTimeout(testSemanticIndexing, 1000);
            }, 2000);
        });
    </script>
</body>
</html>
