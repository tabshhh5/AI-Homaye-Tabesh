# PR13: Global Inspector - Advanced Plugin Monitoring System

> **ูุณุฎู ูพุดุฑูุชู ูุงุธุฑ ฺฉู** - ุณุณุชู ุงูุฏฺฉุณฺฏุฐุงุฑ ุฎูุฏฺฉุงุฑ ู ูพุงุด ฺฉูพุงุฑฺู ุงฺฉูุณุณุชู

---

## ๐ ุฎูุงุตู

PR13 ุณุณุชู "ูุงุธุฑ ฺฉู" (Global Inspector) ุฑุง ุจู ููุง ุชุงุจุด ุงุถุงูู ูโฺฉูุฏ ฺฉู ูุงุจูุชโูุง ุฒุฑ ุฑุง ูุฑุงูู ูโุขูุฑุฏ:

1. **ุงูุฏฺฉุณฺฏุฐุงุฑ ุฎูุฏฺฉุงุฑ**: ุงุณุชุฎุฑุงุฌ ู ุฐุฎุฑู ุฎูุฏฺฉุงุฑ ุชูุธูุงุช ุงูุฒูููโูุง
2. **ูฺฏุงุดุช ุงูุณุงู**: ุชุจุฏู ุชูุธูุงุช ูู ุจู ูุชูู ูุงุจู ููู ุจุฑุง AI
3. **ููฺฏุงูโุณุงุฒ Knowledge Base**: ุจูโุฑูุฒุฑุณุงู ุฎูุฏฺฉุงุฑ ูพุงฺฏุงู ุฏุงูุด
4. **ุฑุงุจุท ฺฉุงุฑุจุฑ ูพุดุฑูุชู**: ูุฏุฑุช ูุธุงุฑุช ุจุฑ ุงูุฒูููโูุง ุงุฒ ุฏุงุดุจูุฑุฏ
5. **ุงููุช ุฏุงุฏู**: ููุชุฑ ฺฉุฑุฏู ุงุทูุงุนุงุช ุญุณุงุณ (API Keysุ Passwords)

---

## ๐ฏ ูุดฺฉู ู ุฑุงูโุญู

### ูุดฺฉู

ุณุงุชโูุง ูุฑุฏูพุฑุณ ุงุฒ ุงูุฒูููโูุง ูุฎุชูู ุงุณุชูุงุฏู ูโฺฉููุฏ ฺฉู ูุฑ ฺฉุฏุงู ูุงุจูุชโูุง ุฎุงุต ุฎูุฏ ุฑุง ุฏุงุฑูุฏ. ููุง ุจุฏูู ุฏุงูุด ุงุฒ ุงู ุงูุฒูููโูุง ููโุชูุงูุฏ ูพุงุณุฎโูุง ุฏูู ู ฺฉุงูู ุงุฑุงุฆู ุฏูุฏ.

**ูุซุงู**: ุงฺฏุฑ ุฏุฑ ุงูุฒููู ุชุงุจุด ููุช ุทุฑุงุญ ุชุบุฑ ฺฉูุฏุ ููุง ุจุงุฏ ุจุชูุงูุฏ ุงู ุชุบุฑ ุฑุง ุชุดุฎุต ุฏูุฏ ู ุจู ฺฉุงุฑุจุฑุงู ุงุทูุงุน ุฏูุฏ.

### ุฑุงูโุญู

ูุงุธุฑ ฺฉู ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ:
- โ ุชูุธูุงุช ุงูุฒูููโูุง ุฑุง ุงุฒ ุฏุชุงุจุณ ุงุณุชุฎุฑุงุฌ ูโฺฉูุฏ
- โ ุชุบุฑุงุช ุฑุง ุดูุงุณุง ู ุซุจุช ูโฺฉูุฏ
- โ ุฏุงูุด ููุง ุฑุง ุจุฏูู ุฏุฎุงูุช ุฏุณุช ุจูโุฑูุฒุฑุณุงู ูโฺฉูุฏ
- โ ุงุทูุงุนุงุช ุญุณุงุณ ุฑุง ููุชุฑ ูโฺฉูุฏ

---

## ๐ฆ ูุญุชูุงุช - 5 Commits ุงุตู

### Commit 1: HT_Global_Observer_Core
ฺฉูุงุณ ูุฑฺฉุฒ ุจุฑุง ูุฏุฑุช ูุธุงุฑุช ุจุฑ ุงูุฒูููโูุง

**ูุงุจูุชโูุง:**
- ุดููุฏ ุจูโุฑูุฒุฑุณุงู ุชูุธูุงุช (`updated_option`)
- ุดููุฏ ูุนุงู/ุบุฑูุนุงู ุดุฏู ุงูุฒูููโูุง
- ุดููุฏ ุจูโุฑูุฒุฑุณุงู ุงูุฒูููโูุง
- ุซุจุช ุชุบุฑุงุช ุฏุฑ ุฏุชุงุจุณ
- ููฺฏุงูโุณุงุฒ ููุฑ ุจุง Knowledge Base

**ูุงู:** `includes/HT_Global_Observer_Core.php`

### Commit 2: Plugin Metadata Extractor
ููุชูุฑ ุงุณุชุฎุฑุงุฌ ุจุง ูฺฏุงุดุช ุงูุณุงู

**ูุงุจูุชโูุง:**
- ุชุจุฏู `woocommerce_currency` ุจู "ูุงุญุฏ ูพูู ูุฑูุดฺฏุงู: ุชููุงู"
- ุชุจุฏู `yes/no` ุจู "ูุนุงู/ุบุฑูุนุงู"
- ูฺฏุงุดุชโูุง ุฎุงุต WooCommerce ู ุงูุฒูููโูุง ูุญุจูุจ
- ูุฑูุช ฺฉุฑุฏู ุงุนุฏุงุฏ ู ุขุฑุงูโูุง

**ุงูุฒูุฏู ุดุฏู ุจู:** `includes/HT_Metadata_Mining_Engine.php`

### Commit 3: Auto KB Synchronizer
ููฺฏุงูโุณุงุฒ ุฎูุฏฺฉุงุฑ ุจุง ูพุงฺฏุงู ุฏุงูุด

**ูุงุจูุชโูุง:**
- ุชุจุฏู ูุชุงุฏุชุง ุจู ูฺฉุชโูุง ุณุงุฎุชุงุฑุงูุชู
- ุฐุฎุฑู ุฏุฑ JSON ู ุฏุชุงุจุณ
- Cron job ุจุฑุง ุจูโุฑูุฒุฑุณุงู ุฏูุฑูโุง
- ฺฉุด ููุดููุฏ (6 ุณุงุนุช)

**ุงูุฒูุฏู ุดุฏู ุจู:** `includes/HT_Knowledge_Base.php`

### Commit 4: Admin Observer Settings
ุฑุงุจุท ฺฉุงุฑุจุฑ ุฏุฑ ุฏุงุดุจูุฑุฏ ุงุทูุณ

**ูุงุจูุชโูุง:**
- ูุณุช ุงูุฒูููโูุง ูุตุจ ุดุฏู ุจุง ุฌุฒุฆุงุช
- ุงุถุงูู/ุญุฐู ุงูุฒูููโูุง ุงุฒ ูุณุช ูุธุงุฑุช
- ููุงุด ุชุบุฑุงุช ุงุฎุฑ
- ููุงุด ูฺฉุชโูุง ุงุณุชุฎุฑุงุฌ ุดุฏู
- ุฑูุฑุด ุฏุณุช ูุชุงุฏุชุง

**ูุงูโูุง:**
- `includes/HT_Admin.php` (render_observer_page)
- `includes/HT_Global_Observer_API.php`

### Commit 5: Safety Data Sanitizer
ูุงู ุงููุช ุจุฑุง ููุชุฑ ุงุทูุงุนุงุช ุญุณุงุณ

**ูุงุจูุชโูุง:**
- ููุชุฑ ฺฉูุฏูุง ุญุณุงุณ (password, api_key, token, ...)
- ุดูุงุณุง ุงูฺฏููุง ุญุณุงุณ (email, IP, credit card)
- ูุงุณฺฉ ฺฉุฑุฏู ุฏุงุฏูโูุง ุญุณุงุณ
- ฺฏุฒุงุฑุด ุณุงูุชุงุฒ (ฺูุฏ ุฏุฑุตุฏ ููุชุฑ ุดุฏ)

**ูุงู:** `includes/HT_Safety_Data_Sanitizer.php`

---

## ๐ ูุตุจ ู ุฑุงูโุงูุฏุงุฒ

### ูุนุงูโุณุงุฒ ุฎูุฏฺฉุงุฑ

ุจุนุฏ ุงุฒ mergeุ ุชูุงู ูุงุจูุชโูุง ุฎูุฏฺฉุงุฑ ูุนุงู ูโุดููุฏ:

```php
// ุฏุฑ HT_Core::init_services()
$this->global_observer = HT_Global_Observer_Core::instance();
$this->observer_api = new HT_Global_Observer_API();
```

### ุฏุณุชุฑุณ ุจู ุฏุงุดุจูุฑุฏ

1. ูุงุฑุฏ ูพูู ูุฏุฑุช WordPress ุดูุฏ
2. ุงุฒ ููู ุณูุช ุฑุงุณุชุ "ููุง ุชุงุจุด" ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ
3. ุฑู "๐ ูุงุธุฑ ฺฉู" ฺฉูฺฉ ฺฉูุฏ

---

## ๐ก ูุซุงูโูุง ฺฉุงุฑุจุฑุฏ

### 1. ุฏุฑุงูุช ูุถุนุช ูุงุธุฑ

```php
$observer = HT_Global_Observer_Core::instance();
$summary = $observer->get_monitoring_summary();

// ูุชุฌู:
// [
//   'monitored_count' => 3,
//   'active_count' => 3,
//   'monitored_plugins' => [...],
//   'last_sync' => '2024-01-15 12:30:00'
// ]
```

### 2. ุงุถุงูู ฺฉุฑุฏู ุงูุฒููู ุจู ูุธุงุฑุช

```php
$scanner = new HT_Plugin_Scanner();
$scanner->add_monitored_plugin('woocommerce/woocommerce.php');

// ูุชุงุฏุชุง ุฎูุฏฺฉุงุฑ ุฑูุฑุด ูโุดูุฏ
```

### 3. ุฏุฑุงูุช ูฺฉุชโูุง ุงุณุชุฎุฑุงุฌ ุดุฏู

```php
$kb = new HT_Knowledge_Base();
$facts = $kb->get_plugin_facts();

// ูุชุฌู:
// [
//   'plugins' => [
//     'woocommerce' => [
//       'features' => ['products', 'orders', 'payments'],
//       'settings' => ['ูุงุญุฏ ูพูู ูุฑูุดฺฏุงู: ุชููุงู', 'ุฎุฑุฏ ูููุงู: ูุนุงู'],
//       'facts' => [...]
//     ]
//   ]
// ]
```

### 4. ุณุงูุชุงุฒ ุฏุงุฏู ูุจู ุงุฒ ุงุฑุณุงู ุจู AI

```php
$sanitizer = new HT_Safety_Data_Sanitizer();

$metadata = ['woocommerce_api_key' => 'sk_test_12345'];
$safe_metadata = $sanitizer->sanitize_metadata($metadata);

// ูุชุฌู:
// ['woocommerce_api_key' => '[FILTERED]']
```

### 5. ุชููุฏ ฺฉุงูุชฺฉุณุช ุจุฑุง AI

```php
$generator = new HT_Dynamic_Context_Generator();
$context = $generator->generate_full_context();

// ฺฉุงูุชฺฉุณุช ุดุงูู:
// - ูุณุช ุงูุฒูููโูุง ูุนุงู
// - ุชูุธูุงุช ููู
// - ูฺฉุชโูุง ุงุณุชุฎุฑุงุฌ ุดุฏู
// - ุฑูุฏุงุฏูุง ุงุฎุฑ
// (ุชูุงู ุงุทูุงุนุงุช ุญุณุงุณ ููุชุฑ ุดุฏูโุงูุฏ)
```

---

## ๐ ูููฺุงุฑุชโูุง

### Flow 1: ุงุณุชุฎุฑุงุฌ ุฎูุฏฺฉุงุฑ ูุชุงุฏุชุง

```
Cron: homa_refresh_plugin_metadata (ูุฑ 12 ุณุงุนุช)
    โ
Plugin Scanner โ ูุณุช ุงูุฒูููโูุง ุชุญุช ูุธุฑ
    โ
Metadata Mining Engine โ ุจุฑุง ูุฑ ุงูุฒููู:
    โ
1. ุงุณุชุฎุฑุงุฌ Options ุงุฒ wp_options
2. ุชุจุฏู ุจู ูุชู ุงูุณุงู (Commit 2)
3. ููุชุฑ ุฏุงุฏูโูุง ุญุณุงุณ (Commit 5)
    โ
ุฐุฎุฑู ุฏุฑ Cache (6 ุณุงุนุช)
    โ
Auto KB Synchronizer (Commit 3)
    โ
ุฐุฎุฑู ุฏุฑ knowledge-base/plugin_metadata.json
```

### Flow 2: ุดููุฏ ุชุบุฑุงุช ูุญุธูโุง

```
ุงุฏูู: ุชุบุฑ ุชูุธูุงุช WooCommerce
    โ
WordPress Hook: updated_option
    โ
Global Observer โ is_monitored_option() ?
    โ ุจูู
is_sensitive_data() ?
    โ ุฎุฑ
ุซุจุช ุชุบุฑ ุฏุฑ ูุงฺฏ
    โ
ุชุจุฏู ุจู ูฺฉุช ุงูุณุงู
    โ
sync_immediately() โ ุงูุฒูุฏู ุจู Knowledge Base
    โ
ููุง ุญุงูุง ูโุฏุงูุฏ: "ูุงุญุฏ ูพูู ูุฑูุดฺฏุงู ุจู ุฏูุงุฑ ุชุบุฑ ฺฉุฑุฏ"
```

### Flow 3: ูุฏุฑุช ุงุฒ ุฏุงุดุจูุฑุฏ

```
ุงุฏูู โ ุตูุญู "ูุงุธุฑ ฺฉู"
    โ
AJAX: /observer/plugins
    โ
ูุณุช ุงูุฒูููโูุง ูุตุจ ุดุฏู
    โ
ฺฉูฺฉ: "ุงุถุงูู ุจู ูุธุงุฑุช" ุฑู ุงูุฒููู X
    โ
POST: /observer/monitor/add
    โ
ุงูุฒูุฏู ุจู ูุณุช
    โ
ุฑูุฑุด ุฎูุฏฺฉุงุฑ ูุชุงุฏุชุง
    โ
ููุงุด: "โ ุงูุฒููู ุจู ูุณุช ูุธุงุฑุช ุงุถุงูู ุดุฏ"
```

---

## ๐ ุงููุช

### 1. ููุชุฑ ฺฉูุฏูุง ุญุณุงุณ

```php
// ูุณุช ฺฉุงูู ฺฉููุงุช ฺฉูุฏ ุญุณุงุณ
[
  'password', 'api_key', 'secret', 'token', 
  'access_key', 'private_key', 'auth', 
  'credential', 'license_key', ...
]
```

### 2. ุดูุงุณุง ุงูฺฏููุง ุญุณุงุณ

- ุดูุงุฑู ฺฉุงุฑุช: `xxxx-xxxx-xxxx-xxxx`
- ุงูู: `user@domain.com` โ `[EMAIL_FILTERED]`
- IP Address: `192.168.1.1` โ `[IP_FILTERED]`
- JWT Token โ `[TOKEN_FILTERED]`

### 3. Whitelist Approach

ููุท ุชูุธูุงุช ฺฉู ุฏุฑ whitelist ูุณุชูุฏ ุงุณุชุฎุฑุงุฌ ูโุดููุฏ. ุจูู ุจู ุตูุฑุช ูพุดโูุฑุถ ููุชุฑ ูโุดููุฏ.

### 4. ุฏุณุชุฑุณ API

ุชูุงู endpoint ูุง `/observer/*` ููุท ุจุฑุง `manage_options` (Administrator) ุฏุฑ ุฏุณุชุฑุณ ูุณุชูุฏ.

---

## โก Performance

### Caching Strategy

| ุฏุงุฏู | ูุฏุช ุฒูุงู | ูุญู ุฐุฎุฑู |
|------|---------|-----------|
| Metadata | 6 ุณุงุนุช | Transient + Option |
| Plugin Facts | 12 ุณุงุนุช | JSON File + Option |
| Recent Facts | 1 ุณุงุนุช | Transient |
| Observer Log | 30 ุฑูุฒ | Database |

### Database Tables

```sql
-- ูุงฺฏ ุชุบุฑุงุช
wp_homa_observer_log (event_type, event_data, created_at)

-- ูฺฉุชโูุง ุงุณุชุฎุฑุงุฌ ุดุฏู
wp_homa_knowledge (fact, category, source, created_at)

-- ุฑูุฏุงุฏูุง Hook
wp_homa_hook_events (hook_name, args_summary, event_time)
```

### Background Jobs

```php
// Cron Jobs
homa_refresh_plugin_metadata (twicedaily)  // ุงุณุชุฎุฑุงุฌ ูุชุงุฏุชุง
homa_auto_sync_kb (twicedaily)             // ููฺฏุงูโุณุงุฒ KB
homa_cleanup_observer_log (weekly)         // ูพุงฺฉุณุงุฒ ูุงฺฏโูุง ูุฏู
```

---

## ๐ REST API Reference

### GET `/homaye/v1/observer/status`
ุฏุฑุงูุช ุฎูุงุตู ูุถุนุช ูุงุธุฑ

**Response:**
```json
{
  "success": true,
  "data": {
    "monitored_count": 3,
    "active_count": 3,
    "monitored_plugins": [...],
    "last_sync": "2024-01-15 12:30:00"
  }
}
```

### GET `/homaye/v1/observer/plugins`
ูุณุช ุงูุฒูููโูุง ูุตุจ ุดุฏู

### POST `/homaye/v1/observer/monitor/add`
ุงุถุงูู ฺฉุฑุฏู ุงูุฒููู ุจู ูุธุงุฑุช

**Parameters:**
- `plugin_path` (required): ูุณุฑ ุงูุฒููู

### POST `/homaye/v1/observer/monitor/remove`
ุญุฐู ุงูุฒููู ุงุฒ ูุธุงุฑุช

### GET `/homaye/v1/observer/changes`
ูุณุช ุชุบุฑุงุช ุงุฎุฑ

### GET `/homaye/v1/observer/facts`
ูุณุช ูฺฉุชโูุง ุงุณุชุฎุฑุงุฌ ุดุฏู

### GET `/homaye/v1/observer/metadata`
ุฏุฑุงูุช ูุชุงุฏุชุง ุชูุงู ุงูุฒูููโูุง

### POST `/homaye/v1/observer/refresh`
ุฑูุฑุด ุฏุณุช ูุชุงุฏุชุง

---

## ๐งช ุชุณุช

### ุชุณุช 1: ุดูุงุณุง ุชุบุฑ ููุช

```php
// ุฏุฑ ุงูุฒููู ุชุงุจุดุ ููุช ุทุฑุงุญ ุฑุง ุชุบุฑ ุฏูุฏ
update_option('tabesh_design_price', 50000);

// ุจุฑุฑุณ:
$facts = get_transient('homa_recent_facts');
// ุจุงุฏ ุดุงูู: "ุชูุธู tabesh_design_price ุจู 50000 ุชุบุฑ ฺฉุฑุฏ."
```

### ุชุณุช 2: ููุชุฑ ุฏุงุฏูโูุง ุญุณุงุณ

```php
$sanitizer = new HT_Safety_Data_Sanitizer();

// ุชุณุช 1: API Key
$is_sensitive = $sanitizer->is_sensitive_key('woocommerce_api_key');
// ูุชุฌู: true

// ุชุณุช 2: Email
$text = "ุงูู ูู test@example.com ุงุณุช";
$safe = $sanitizer->sanitize_text($text);
// ูุชุฌู: "ุงูู ูู [EMAIL_FILTERED] ุงุณุช"
```

### ุชุณุช 3: ุฏุงุดุจูุฑุฏ ูุฏุฑุช

1. ูุงุฑุฏ ุฏุงุดุจูุฑุฏ "ูุงุธุฑ ฺฉู" ุดูุฏ
2. ุงูุฒููู WooCommerce ุฑุง ุจู ูุธุงุฑุช ุงุถุงูู ฺฉูุฏ
3. ุจุฑุฑุณ ฺฉูุฏ ฺฉู "ุชุนุฏุงุฏ ุงูุฒูููโูุง ุชุญุช ูุธุฑ" ุงูุฒุงุด ุงูุชู ุงุณุช
4. ุฏฺฉูู "ุจูโุฑูุฒุฑุณุงู ูุชุงุฏุชุง" ุฑุง ุจุฒูุฏ
5. ุจุฑุฑุณ ฺฉูุฏ ฺฉู "ูฺฉุชโูุง ุงุณุชุฎุฑุงุฌ ุดุฏู" ููุงุด ุฏุงุฏู ูโุดููุฏ

---

## ๐ ุงุฑุชุจุงุท ุจุง PRูุง ูุจู

| PR | ุงุณุชูุงุฏู | ฺฺฏููู |
|----|---------|-------|
| PR12 | Hook Observer | ุดููุฏ ุฑูุฏุงุฏูุง ุณุณุชู |
| PR9 | Atlas Dashboard | ุฑุงุจุท ฺฉุงุฑุจุฑ |
| PR8 | Knowledge Base | ุฐุฎุฑู ูฺฉุชโูุง |
| PR1-6 | Core System | ุฒุฑุณุงุฎุช ุงุตู |

---

## ๐ ูุชุฌู

ุจุง PR13ุ ููุง ุชุงุจุด ุญุงูุง ูโุชูุงูุฏ:

โ **ุฎูุฏฺฉุงุฑ ุชูุธูุงุช ุงูุฒูููโูุง ุฑุง ุจุฎูุงูุฏ**  
โ **ุชุบุฑุงุช ุฑุง ูุญุธูโุง ุชุดุฎุต ุฏูุฏ**  
โ **ุฏุงูุด ุฎูุฏ ุฑุง ุจุฏูู ุฏุฎุงูุช ุฏุณุช ุจูโุฑูุฒุฑุณุงู ฺฉูุฏ**  
โ **ุงุทูุงุนุงุช ุญุณุงุณ ุฑุง ููุชุฑ ฺฉูุฏ**  
โ **ฺฉุงูุชฺฉุณุช ุบูโุชุฑ ุจู AI ุงุฑุงุฆู ุฏูุฏ**

**ููุง ุญุงูุง ฺฉ ูุงุธุฑ ููุดููุฏ ุฏุงุฑุฏ! ๐**

---

**Version**: 1.0.0  
**Author**: Tabshhh4  
**Date**: 2024-01-15  
**Status**: โ Ready for Review
